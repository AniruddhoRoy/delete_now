FROM node:20.19.6-alpine

WORKDIR /usr/src/app

# Enable pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

# Copy root config files first
COPY package.json pnpm-workspace.yaml turbo.json ./

# Copy workspace packages
COPY apps ./apps
COPY packages ./packages

# Install dependencies
RUN pnpm install

# Build all packages
RUN pnpm run build

# Start the web app
CMD ["pnpm", "start_web"]
